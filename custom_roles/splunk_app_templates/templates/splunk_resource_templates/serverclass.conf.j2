# ===============================================================================
# serverclass.conf - Generated by Splunk App Templates
# ===============================================================================
# Generated on: {{ ansible_date_time.iso8601 }}
# Tenant: {{ template_vars.tenant }}
# App: {{ template_vars.app_name }}
# Environment: {{ template_vars.environment }}
# ===============================================================================

{% for serverclass_name in serverclasses %}
{% set serverclass_config = {
  'serverclass_name': serverclass_name,
  'whitelist': [template_vars.tenant + '_' + serverclass_name + '_*'],
  'apps': apps_generated_from_template | default([])
} %}

[serverClass:{{ serverclass_config.serverclass_name }}]
# Auto-generated serverclass for {{ template_vars.tenant }} {{ template_vars.app_name }}
{% for whitelist_item in serverclass_config.whitelist %}
whitelist.{{ loop.index0 }} = {{ whitelist_item }}
{% endfor %}
repositoryLocation = $SPLUNK_HOME/etc/deployment-apps
tmpFolder = $SPLUNK_HOME/var/run
restartSplunkWeb = false
restartSplunkd = false
stateOnClient = enabled

{% for app_name in serverclass_config.apps %}
[serverClass:{{ serverclass_config.serverclass_name }}:app:{{ app_name }}]
# App: {{ app_name }}
restartSplunkd = true
restartSplunkWeb = false
stateOnClient = enabled

{% endfor %}
{% endfor %}

# ===============================================================================
# Global settings
# ===============================================================================
[global]
crossServerChecksum = true
restartSplunkWeb = false
restartSplunkd = false

# ===============================================================================
# Auto-generated metadata
# Template: {{ template_vars.app_name }}
# Generated by: {{ template_vars.deployed_by | default('ansible') }}
# Deployment method: {{ template_vars.deployment_method | default('ansible') }}
# ===============================================================================